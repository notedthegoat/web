<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ìŠ¤ë ˆë“œ ë’·ì‚­ì •ë¦¬í•˜ê¸° (JSON)</title>
<style>
* {
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Arial, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    margin: 0;
    padding: 15px;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
}

.container {
    background: white;
    padding: 25px;
    border-radius: 15px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    max-width: 700px;
    width: 100%;
}

h1 {
    color: #667eea;
    margin-top: 0;
    text-align: center;
    font-size: clamp(1.4rem, 5vw, 1.8rem);
}

/* ì‚¬ìš©ë°©ë²• ì„¹ì…˜ */
.how-to-use {
    background: linear-gradient(135deg, #fff9e6 0%, #fff3cd 100%);
    border: 2px solid #ffc107;
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 20px;
}

.how-to-use-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
}

.how-to-use-header h3 {
    margin: 0;
    color: #856404;
    font-size: 1rem;
}

.youtube-link {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 15px;
    background: #fff;
    border-radius: 10px;
    text-decoration: none;
    transition: all 0.3s;
    border: 2px solid #ff0000;
}

.youtube-link:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(255, 0, 0, 0.2);
    background: #fff5f5;
}

.youtube-icon {
    width: 48px;
    height: 48px;
    background: #ff0000;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.youtube-icon svg {
    width: 28px;
    height: 28px;
    fill: white;
}

.youtube-text {
    flex: 1;
}

.youtube-text strong {
    display: block;
    color: #333;
    font-size: 0.95rem;
    margin-bottom: 3px;
}

.youtube-text span {
    color: #ff0000;
    font-size: 0.85rem;
    font-weight: 500;
}

/* ë§Œë“ ì´ ì„¹ì…˜ */
.creator-box {
    text-align: center;
    padding: 12px 15px;
    background: linear-gradient(135deg, #f8f9ff 0%, #e8ecff 100%);
    border-radius: 10px;
    margin-bottom: 20px;
    border: 2px solid #667eea;
}

.creator-box p {
    margin: 0;
    color: #333;
    font-size: 0.95rem;
}

.creator-box a {
    color: #667eea;
    text-decoration: none;
    font-weight: bold;
    transition: color 0.3s;
}

.creator-box a:hover {
    color: #764ba2;
}

/* íŒŒì¼ ì—…ë¡œë“œ ì„¹ì…˜ */
.file-input-wrapper {
    margin-bottom: 15px;
    padding: 20px;
    border: 2px dashed #667eea;
    border-radius: 10px;
    text-align: center;
    background: #f8f9ff;
    transition: all 0.3s;
}

.file-input-wrapper:hover {
    border-color: #764ba2;
    background: #f0f2ff;
}

input[type="file"] {
    display: none;
}

.file-label {
    display: inline-block;
    padding: 12px 30px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s;
    font-weight: bold;
    font-size: 0.95rem;
}

.file-label:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
}

.status {
    color: #28a745;
    font-weight: bold;
    margin-top: 10px;
    display: none;
    padding: 8px;
    background: #e8f5e9;
    border-radius: 5px;
}

.info-text {
    color: #666;
    font-size: 13px;
    margin: 10px 0 0 0;
}

/* ë²„íŠ¼ */
.process-btn {
    width: 100%;
    padding: 15px;
    background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
    margin-top: 10px;
    margin-bottom: 25px;
    transition: all 0.3s;
    display: none;
}

.process-btn:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(118, 75, 162, 0.3);
}

.process-btn:disabled {
    background: #ccc;
    cursor: not-allowed;
}

/* ê²°ê³¼ ì„¹ì…˜ */
#result {
    padding: 20px;
    background: #f8f9ff;
    border-radius: 10px;
    min-height: 150px;
    max-height: 400px;
    overflow-y: auto;
    display: none;
    border-top: 3px solid #667eea;
}

.unfollower-item {
    padding: 12px 15px;
    margin: 8px 0;
    background: white;
    border-left: 4px solid #764ba2;
    border-radius: 5px;
    transition: all 0.2s;
}

.unfollower-item:hover {
    transform: translateX(5px);
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
}

.unfollower-item a {
    color: #667eea;
    text-decoration: none;
    font-weight: 500;
}

.unfollower-item a:hover {
    color: #764ba2;
    text-decoration: underline;
}

.count-badge {
    display: inline-block;
    padding: 10px 20px;
    background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
    color: white;
    border-radius: 25px;
    font-weight: bold;
    font-size: 1rem;
}

/* ëª¨ë°”ì¼ ìµœì í™” */
@media (max-width: 480px) {
    body {
        padding: 10px;
        align-items: flex-start;
    }

    .container {
        padding: 20px 15px;
    }

    .youtube-link {
        padding: 10px 12px;
    }

    .youtube-icon {
        width: 42px;
        height: 42px;
    }

    .youtube-icon svg {
        width: 24px;
        height: 24px;
    }

    .youtube-text strong {
        font-size: 0.9rem;
    }

    .youtube-text span {
        font-size: 0.8rem;
    }

    .file-input-wrapper {
        padding: 15px;
    }

    .file-label {
        padding: 10px 20px;
        font-size: 0.9rem;
    }

    .process-btn {
        padding: 14px;
        font-size: 16px;
    }

    #result {
        padding: 15px;
        max-height: 300px;
    }

    .count-badge {
        padding: 8px 16px;
        font-size: 0.9rem;
    }

    .unfollower-item {
        padding: 10px 12px;
        font-size: 0.9rem;
    }
}
</style>
</head>
<body>
<div class="container">
    <h1>ğŸ” ìŠ¤ë ˆë“œ ë’·ì‚­ì •ë¦¬í•˜ê¸° (JSON)</h1>
    
    <!-- ì‚¬ìš©ë°©ë²• ì„¹ì…˜ -->
    <div class="how-to-use">
        <div class="how-to-use-header">
            <span style="font-size: 1.3rem;">ğŸ“–</span>
            <h3>ì²˜ìŒì´ì‹ ê°€ìš”? ì‚¬ìš©ë°©ë²•ì„ í™•ì¸í•˜ì„¸ìš”!</h3>
        </div>
        <a href="https://youtu.be/1Z2s1hL2i1I" target="_blank" class="youtube-link">
            <div class="youtube-icon">
                <svg viewBox="0 0 24 24">
                    <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                </svg>
            </div>
            <div class="youtube-text">
                <strong>ğŸ“º ì‚¬ìš©ë°©ë²• ì˜ìƒ ë³´ê¸°</strong>
                <span>â–¶ YouTubeì—ì„œ í™•ì¸í•˜ê¸°</span>
            </div>
        </a>
    </div>
    
    <!-- ë§Œë“ ì´ ì„¹ì…˜ -->
    <div class="creator-box">
        <p>
            ë§Œë“ ì´: <a href="https://www.threads.com/@jeremy.s.0416?xmt=AQF00jBCTUkLMSu5ixNLrxiI9eck747lbbZI8vDt2-IRegg" target="_blank">Jeremy (@jeremy.s.0416)</a>
        </p>
    </div>
    
    <!-- íŒŒì¼ ì—…ë¡œë“œ -->
    <div class="file-input-wrapper">
        <label for="followerFile" class="file-label">ğŸ“ íŒ”ë¡œì›Œ JSON ì—…ë¡œë“œ</label>
        <input type="file" id="followerFile" accept=".json">
        <p class="info-text">followers.json íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”</p>
        <div class="status" id="followerStatus">âœ… íŒ”ë¡œì›Œ 0ëª… ë¡œë“œë¨</div>
    </div>
    
    <div class="file-input-wrapper">
        <label for="followingFile" class="file-label">ğŸ“ íŒ”ë¡œì‰ JSON ì—…ë¡œë“œ</label>
        <input type="file" id="followingFile" accept=".json">
        <p class="info-text">following.json íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”</p>
        <div class="status" id="followingStatus">âœ… íŒ”ë¡œì‰ 0ëª… ë¡œë“œë¨</div>
    </div>
    
    <button class="process-btn" id="processBtn" onclick="processUnfollowers()">
        ğŸš€ ë’·ì‚­ì •ë¦¬í•˜ê¸°
    </button>
    
    <div id="result"></div>
</div>

<script>
let followerData = new Set();
let followingData = [];

function fixEncoding(str) {
    try {
        const bytes = new Uint8Array([...str].map(c => c.charCodeAt(0)));
        const decoder = new TextDecoder('utf-8');
        return decoder.decode(bytes);
    } catch (e) {
        return str;
    }
}

document.getElementById('followerFile').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
            try {
                const text = event.target.result;
                const json = JSON.parse(text);
                
                followerData = extractFollowerIds(json);
                const status = document.getElementById('followerStatus');
                status.textContent = `âœ… íŒ”ë¡œì›Œ ${followerData.size}ëª… ë¡œë“œë¨`;
                status.style.display = 'block';
                checkReadyToProcess();
            } catch (error) {
                alert('íŒ”ë¡œì›Œ JSON íŒŒì¼ ì½ê¸° ì˜¤ë¥˜: ' + error.message);
            }
        };
        reader.readAsText(file, 'UTF-8');
    }
});

document.getElementById('followingFile').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
            try {
                const text = event.target.result;
                const json = JSON.parse(text);
                
                followingData = extractFollowingData(json);
                const status = document.getElementById('followingStatus');
                status.textContent = `âœ… íŒ”ë¡œì‰ ${followingData.length}ëª… ë¡œë“œë¨`;
                status.style.display = 'block';
                checkReadyToProcess();
            } catch (error) {
                alert('íŒ”ë¡œì‰ JSON íŒŒì¼ ì½ê¸° ì˜¤ë¥˜: ' + error.message);
            }
        };
        reader.readAsText(file, 'UTF-8');
    }
});

function extractFollowerIds(json) {
    const ids = new Set();
    const followers = json.text_post_app_text_post_app_followers || [];
    
    followers.forEach(item => {
        if (item.string_list_data && item.string_list_data[0] && item.string_list_data[0].value) {
            ids.add(item.string_list_data[0].value);
        }
    });
    
    return ids;
}

function extractFollowingData(json) {
    const users = [];
    const following = json.text_post_app_text_post_app_following || [];
    
    following.forEach(item => {
        if (item.string_list_data && item.string_list_data[0]) {
            const userData = item.string_list_data[0];
            if (userData.value) {
                let displayName = item.title || userData.value;
                displayName = fixEncoding(displayName);
                
                users.push({
                    id: userData.value,
                    name: displayName,
                    href: userData.href || `https://www.threads.net/@${userData.value}`
                });
            }
        }
    });
    
    return users;
}

function checkReadyToProcess() {
    const btn = document.getElementById('processBtn');
    if (followerData.size > 0 && followingData.length > 0) {
        btn.style.display = 'block';
        btn.disabled = false;
    }
}

function processUnfollowers() {
    const unfollowers = followingData.filter(user => !followerData.has(user.id));
    
    const resultDiv = document.getElementById('result');
    resultDiv.style.display = 'block';
    
    if (unfollowers.length === 0) {
        resultDiv.innerHTML = `
            <div style="text-align:center; padding:30px;">
                <h2 style="color:#667eea;">ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤!</h2>
                <p>ë’·ì‚­í•œ ì‚¬ëŒì´ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
        `;
        return;
    }
    
    let html = `<div style="text-align:center;"><div class="count-badge">ğŸš¨ ë’·ì‚­í•œ ì¸ê°„ë“¤: ${unfollowers.length}ëª…</div></div><div style="margin-top:15px;">`;
    
    unfollowers.forEach(user => {
        const displayName = user.name;
        html += `
            <div class="unfollower-item">
                <a href="${user.href}" target="_blank">
                    @${user.id} (${displayName})
                </a>
            </div>
        `;
    });
    
    html += '</div>';
    resultDiv.innerHTML = html;
}
</script>
</body>
</html>
